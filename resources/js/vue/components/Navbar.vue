<template>
    <nav class="bg-white shadow-lg">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between">
                <div class="flex space-x-7">
                    <div>
                        <!-- Website Logo -->
                        <a href="/" class="flex items-center py-4 px-2">
                            <svg class="fill-current mr-2" width="87" height="54" viewBox="0 0 87 54" xmlns="http://www.w3.org/2000/svg">
                                <g id="surface1">
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 75.660156 2.230469 C 74.34375 4.933594 73.378906 5.941406 71.203125 6.769531 L 69.601562 7.378906 L 70.457031 8.460938 L 71.347656 9.539062 L 73.414062 7.308594 C 75.375 5.257812 75.875 4.285156 76.445312 1.691406 C 76.730469 0.433594 77.480469 0.433594 80.511719 1.800781 C 83.503906 3.167969 85.503906 4.570312 85.753906 5.4375 C 86.074219 6.445312 84.71875 8.136719 82.507812 9.574219 C 80.402344 10.945312 79.511719 12.277344 79.511719 14.148438 C 79.511719 15.550781 80.152344 17.640625 80.582031 17.640625 C 81.152344 17.640625 81.152344 16.777344 80.617188 15.265625 C 79.832031 13.03125 80.546875 11.664062 83.21875 10.296875 C 86.75 8.496094 87.855469 6.121094 86.144531 4.066406 C 85.109375 2.84375 80.117188 0.359375 78.121094 0.109375 L 76.730469 -0.0703125 Z M 75.660156 2.230469 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 75.410156 8.351562 C 69.386719 15.085938 69.8125 20.664062 76.660156 24.660156 C 76.945312 24.839844 76.445312 24.121094 75.484375 23.074219 C 71.738281 18.828125 71.988281 13.824219 76.339844 8.027344 C 77.125 6.984375 77.695312 6.121094 77.585938 6.121094 C 77.515625 6.121094 76.515625 7.128906 75.410156 8.351562 Z M 64.5 7.523438 C 63.394531 8.675781 63.183594 9.898438 63.929688 10.980469 C 64.574219 11.808594 65.070312 11.089844 64.535156 10.117188 C 64.039062 9.109375 64.074219 8.746094 64.894531 7.921875 C 65.964844 6.839844 67.996094 6.949219 68.53125 8.101562 C 68.957031 9.109375 69.527344 9.289062 69.527344 8.460938 C 69.527344 7.488281 68.171875 6.480469 66.820312 6.480469 C 65.890625 6.480469 65.285156 6.769531 64.5 7.523438 Z M 64.5 7.523438 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 65.605469 8.0625 C 65.605469 8.136719 65.855469 8.386719 66.140625 8.640625 C 66.570312 9 66.675781 9 66.675781 8.496094 C 66.675781 8.171875 66.425781 7.921875 66.140625 7.921875 C 65.855469 7.921875 65.605469 7.992188 65.605469 8.0625 Z M 59.367188 13.5 C 54.480469 15.875 52.269531 19.261719 53.484375 22.464844 C 53.804688 23.328125 53.875 23.363281 54.980469 22.859375 C 56.121094 22.390625 56.15625 22.320312 56.050781 20.59375 C 55.980469 19.476562 56.121094 18.394531 56.441406 17.785156 C 57.085938 16.523438 59.1875 14.507812 61.148438 13.175781 C 63.074219 11.878906 62.363281 12.023438 59.367188 13.5 Z M 27.988281 16.703125 C 25.53125 17.496094 23.710938 18.613281 22.355469 20.125 C 20.789062 21.886719 20.109375 23.183594 19.46875 25.632812 C 19.003906 27.46875 18.933594 27.539062 17.683594 27.648438 C 16.257812 27.792969 15.9375 28.332031 17.222656 28.511719 C 18.007812 28.621094 18.007812 28.65625 18.007812 35.28125 C 18.007812 41.902344 18.007812 41.941406 17.222656 42.046875 C 16.757812 42.121094 16.402344 42.335938 16.402344 42.515625 C 16.402344 42.695312 17.863281 42.839844 19.683594 42.839844 C 21.644531 42.839844 22.820312 42.695312 22.640625 42.515625 C 22.425781 42.335938 21.964844 42.121094 21.570312 42.046875 C 20.894531 41.941406 20.859375 41.652344 20.859375 35.28125 C 20.859375 28.65625 20.859375 28.621094 21.679688 28.511719 C 23.070312 28.296875 22.5 27.71875 20.894531 27.71875 L 19.324219 27.71875 L 19.644531 26.242188 C 20.464844 22.644531 22.960938 19.65625 26.3125 18.289062 C 28.0625 17.605469 28.988281 17.496094 32.804688 17.496094 C 36.582031 17.496094 37.757812 17.640625 40.648438 18.503906 C 42.609375 19.042969 45.425781 19.546875 47.28125 19.691406 L 50.523438 19.90625 L 51.273438 18.792969 C 51.699219 18.214844 52.058594 17.605469 52.058594 17.496094 C 52.058594 17.351562 50.558594 17.351562 48.777344 17.496094 C 46.460938 17.640625 44.214844 17.496094 41.359375 17.0625 C 35.941406 16.234375 29.84375 16.09375 27.988281 16.703125 Z M 76.195312 18.179688 C 75.339844 18.9375 75.269531 19.152344 75.660156 19.980469 C 76.089844 20.953125 76.625 21.167969 76.695312 20.410156 C 76.730469 20.195312 76.765625 19.765625 76.800781 19.476562 C 76.875 18.539062 77.65625 18.683594 77.871094 19.691406 C 78.300781 21.347656 79.511719 23.6875 80.082031 23.902344 C 81.222656 24.335938 81.1875 23.722656 80.046875 22.570312 C 78.976562 21.492188 78.085938 19.402344 78.085938 17.890625 C 78.085938 17.027344 77.371094 17.136719 76.195312 18.179688 Z M 76.195312 18.179688 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 81.117188 18 C 80.296875 18.898438 80.6875 19.402344 81.582031 18.613281 C 82.4375 17.820312 82.722656 18.144531 82.722656 19.980469 C 82.722656 20.953125 83.113281 22.285156 83.789062 23.617188 C 85.039062 26.101562 85.109375 27 84.183594 27.863281 C 83.113281 28.871094 81.332031 28.945312 78.90625 28.117188 C 76.515625 27.289062 74.664062 27.144531 73.808594 27.71875 C 73.414062 27.972656 73.773438 28.078125 75.089844 28.078125 C 76.054688 28.078125 78.121094 28.402344 79.621094 28.800781 C 82.078125 29.449219 82.507812 29.484375 83.578125 29.015625 C 85.894531 28.042969 86.25 25.558594 84.46875 22.390625 C 83.828125 21.203125 83.398438 20.015625 83.433594 19.296875 C 83.46875 18.683594 83.503906 17.964844 83.46875 17.710938 C 83.398438 17.027344 81.828125 17.207031 81.117188 18 Z M 55.089844 27.613281 C 54.695312 27.683594 54.019531 27.828125 53.589844 27.9375 C 52.378906 28.1875 50.238281 30.238281 49.527344 31.859375 C 47.957031 35.316406 49.242188 40.210938 52.164062 41.902344 C 52.984375 42.371094 54.195312 42.875 54.839844 43.019531 C 56.441406 43.34375 59.367188 42.589844 60.652344 41.507812 C 61.222656 41.003906 61.683594 40.714844 61.683594 40.824219 C 61.683594 41.398438 59.6875 45 58.296875 47.015625 C 56.15625 50.003906 56.050781 51.121094 57.796875 52.019531 C 59.152344 52.738281 59.296875 52.632812 58.652344 51.335938 C 57.941406 49.96875 57.976562 49.066406 58.796875 47.953125 C 60.972656 44.785156 63.46875 38.089844 63.46875 35.28125 C 63.46875 31.210938 60.898438 28.1875 57.050781 27.613281 C 56.371094 27.539062 55.480469 27.503906 55.089844 27.613281 Z M 58.367188 29.160156 C 60.1875 30.277344 60.757812 31.753906 60.757812 35.28125 C 60.757812 38.628906 60.257812 40.066406 58.617188 41.363281 C 56.480469 43.054688 53.019531 41.867188 51.84375 38.988281 C 51.203125 37.476562 51.203125 33.085938 51.84375 31.570312 C 52.984375 28.765625 55.945312 27.648438 58.367188 29.160156 Z M 0 28.078125 C 0 28.261719 0.320312 28.441406 0.714844 28.441406 C 1.890625 28.441406 2.140625 29.628906 2.140625 35.0625 C 2.140625 40.390625 1.855469 42.121094 0.925781 42.121094 C 0.640625 42.121094 0.285156 42.265625 0.179688 42.480469 C 0.0351562 42.695312 1.070312 42.839844 2.996094 42.839844 C 4.671875 42.839844 6.0625 42.695312 6.0625 42.515625 C 6.0625 42.335938 5.703125 42.121094 5.242188 42.046875 C 4.492188 41.941406 4.457031 41.761719 4.351562 38.773438 L 4.242188 35.640625 L 11.054688 35.640625 L 11.054688 38.304688 C 11.054688 41.4375 10.875 42.121094 9.949219 42.121094 C 9.589844 42.121094 9.269531 42.265625 9.269531 42.480469 C 9.269531 42.695312 10.519531 42.839844 12.335938 42.839844 C 14.261719 42.839844 15.296875 42.695312 15.152344 42.480469 C 15.046875 42.265625 14.691406 42.121094 14.441406 42.121094 C 13.441406 42.121094 13.191406 40.679688 13.191406 35.28125 C 13.191406 29.878906 13.441406 28.441406 14.441406 28.441406 C 14.691406 28.441406 15.046875 28.261719 15.152344 28.078125 C 15.296875 27.863281 14.261719 27.71875 12.335938 27.71875 C 9.234375 27.71875 8.59375 27.972656 10.089844 28.621094 C 10.804688 28.945312 10.875 29.269531 10.980469 31.753906 L 11.089844 34.558594 L 4.242188 34.558594 L 4.351562 31.570312 C 4.457031 28.835938 4.527344 28.621094 5.277344 28.511719 C 5.703125 28.441406 6.0625 28.222656 6.0625 28.042969 C 6.0625 27.863281 4.707031 27.71875 3.03125 27.71875 C 1.246094 27.71875 0 27.863281 0 28.078125 Z M 23.890625 28.007812 C 23.890625 28.1875 24.210938 28.441406 24.601562 28.546875 C 25.28125 28.726562 25.316406 29.050781 25.316406 35.242188 L 25.316406 41.761719 L 24.425781 42.121094 C 23.925781 42.300781 23.53125 42.550781 23.53125 42.660156 C 23.53125 42.769531 24.886719 42.839844 26.5625 42.839844 C 28.238281 42.839844 29.59375 42.695312 29.59375 42.515625 C 29.59375 42.335938 29.238281 42.121094 28.808594 42.046875 C 28.0625 41.941406 27.988281 41.722656 27.882812 39.203125 L 27.777344 36.46875 L 29.949219 36.253906 C 33.585938 35.855469 35.300781 34.488281 35.300781 32.039062 C 35.300781 30.492188 34.585938 29.375 33.054688 28.546875 C 31.734375 27.863281 23.890625 27.359375 23.890625 28.007812 Z M 32.160156 29.878906 C 33.125 31.066406 33.015625 33.300781 31.910156 34.378906 C 31.269531 35.0625 30.664062 35.28125 29.414062 35.28125 L 27.8125 35.28125 L 27.8125 28.691406 L 29.664062 28.871094 C 31.019531 29.015625 31.699219 29.304688 32.160156 29.878906 Z M 36.011719 27.863281 C 36.011719 28.007812 36.40625 28.261719 36.902344 28.441406 L 37.796875 28.800781 L 37.796875 41.761719 L 36.902344 42.121094 C 36.40625 42.300781 36.011719 42.550781 36.011719 42.660156 C 36.011719 42.769531 37.472656 42.839844 39.292969 42.839844 C 41.253906 42.839844 42.429688 42.695312 42.253906 42.515625 C 42.039062 42.335938 41.574219 42.121094 41.183594 42.046875 C 40.539062 41.941406 40.46875 41.617188 40.363281 39.203125 L 40.253906 36.46875 L 42.429688 36.253906 C 44.640625 36 46.246094 35.386719 47.03125 34.414062 C 47.8125 33.480469 47.957031 31.066406 47.28125 30.058594 C 46.210938 28.441406 44.746094 27.972656 40.21875 27.792969 C 37.902344 27.71875 36.011719 27.71875 36.011719 27.863281 Z M 43.820312 29.339844 C 45.390625 30.132812 45.746094 31.894531 44.746094 33.804688 C 44.140625 34.992188 43.570312 35.28125 41.679688 35.28125 L 40.289062 35.28125 L 40.289062 28.800781 L 41.539062 28.800781 C 42.253906 28.800781 43.285156 29.050781 43.820312 29.339844 Z M 72.058594 31.390625 C 68.03125 36.359375 66.25 43.308594 67.355469 49.390625 C 67.960938 52.597656 68.066406 52.703125 69.671875 52.019531 C 70.707031 51.589844 70.953125 51.300781 70.777344 50.832031 C 69.707031 48.3125 69.421875 46.65625 69.421875 43.378906 C 69.421875 39.132812 70.457031 35.460938 72.738281 31.753906 C 73.523438 30.527344 74.019531 29.519531 73.84375 29.519531 C 73.699219 29.519531 72.878906 30.382812 72.058594 31.390625 Z M 60.078125 51.839844 C 60.222656 52.34375 60.542969 52.957031 60.757812 53.207031 C 61.363281 53.820312 64.5 54.144531 65.605469 53.675781 L 66.496094 53.316406 L 65.570312 53.316406 C 64.144531 53.28125 61.078125 52.234375 60.402344 51.589844 C 59.832031 51.011719 59.832031 51.011719 60.078125 51.839844 Z M 60.078125 51.839844 "/>
                                </g>
                            </svg>
                        </a>
                    </div>
                    <!-- Primary Navbar items -->
                    <div class="hidden md:flex items-center space-x-1">
                        <router-link
                            v-if="isLoggedIn"
                            v-for="link in navLinks"
                            :key="link.path"
                            :to="link.path"
                            active-class="border-b-4 border-green-500 pt-4 pb-3"
                            class="px-2 text-gray-500 font-semibold"
                            :class="{'py-4 hover:text-green-500 transition duration-300': currentPath !== link.path}"
                            custom
                        >
                            {{ link.name }}
                        </router-link>
                    </div>
                </div>
                <!-- Secondary Navbar items -->
                <div class="hidden md:flex items-center space-x-3 ">
                    <router-link
                        v-if="!isLoggedIn"
                        to="/"
                        class="py-2 px-2 font-medium rounded transition duration-300"
                        :class="{'text-gray-500 hover:bg-green-500 hover:text-white': currentPath !== '/', 'text-white bg-green-500 rounded hover:bg-green-400': currentPath === '/'}"
                    >
                        Log In
                    </router-link>
                    <router-link
                        v-if="!isLoggedIn"
                        to="register"
                        class="py-2 px-2 font-medium rounded transition duration-300"
                        active-class="text-white bg-green-500 rounded hover:bg-green-400"
                        :class="{'text-gray-500 hover:bg-green-500 hover:text-white': currentPath !== '/register'}"
                    >
                        Register
                    </router-link>
                    <a
                        href=""
                        v-if="isLoggedIn"
                        @click.prevent="handleLogout"
                        class="py-2 px-2 font-medium rounded transition duration-300 text-gray-500 hover:bg-green-500 hover:text-white"
                    >
                        Log Out
                    </a>
                </div>
                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <button @click="handleMobile" class="outline-none mobile-menu-button">
                        <svg class=" w-6 h-6 text-gray-500 hover:text-green-500 "
                             fill="none"
                             stroke-linecap="round"
                             stroke-linejoin="round"
                             stroke-width="2"
                             viewBox="0 0 24 24"
                             stroke="currentColor"
                        >
                            <path d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- mobile menu -->
        <div class="mobile-menu" :class="{ hidden: isHidden }">
            <ul class="">
                <li
                    v-if="isLoggedIn"
                    v-for="link in navLinks"
                    :class="{ active: currentPath === link.path }"
                    :key="link.path"
                >
                    <router-link
                        :to="link.path"
                        class="block text-sm px-2 py-4"
                        active-class="text-white bg-green-500 font-semibold"
                        :class="{'hover:text-white hover:bg-green-500 transition duration-300': currentPath !== link.path}"
                    >
                        {{ link.name }}
                    </router-link>
                </li>
            </ul>
        </div>
        <loading
            :active="isLoading"
             :is-full-page="true"
        />
    </nav>
</template>

<script>
import {mapActions, mapState} from 'vuex';
import ns from '../store/namespaces';
import Loading from 'vue-loading-overlay';
import 'vue-loading-overlay/dist/vue-loading.css';

export default {
    name: 'navbar',
    components: {
        Loading
    },
    data() {
        return {
            isHidden: true,
            navLinks: [
                {
                    name: 'Users',
                    path: '/users'
                },
                {
                    name: 'Owners',
                    path: '/owners'
                },
                {
                    name: 'Patients',
                    path: '/patients'
                }
            ],
            isLoading: true
        }
    },
    computed: {
        ...mapState(ns.global, ['isLoggedIn']),
        currentPath() {
            return this.$route.path;
        }
    },
    async created() {
        await this.checkLoggedIn().then(() => {
            this.$router.push('/users');
            this.isLoading = false
        }).catch(err => {
            this.isLoading = false
        });
    },
    methods: {
        ...mapActions(ns.global, ['logOut', 'checkLoggedIn']),
        handleMobile() {
            this.isHidden = !this.isHidden;
        },
        handleLogout() {
            this.isLoading = true;

            this.logOut().then(() => {
                this.$router.push('/');
                this.isLoading = false
            }).catch(err => {
                this.isLoading = false
            });
        }
    }
};
</script>
